do $$ declare default_search_path varchar(50); table_row record; query text; schemaaux text; begin for table_row in select current_setting('search_path') loop default_search_path := table_row.current_setting; end loop; for table_row in select schema_name from information_schema.schemata where schema_name in (%dataset_name%) order by schema_name loop execute 'select set_config($1, $2, false)' using 'search_path', table_row.schema_name || ',public'; begin begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); RAISE NOTICE 'Dataset %',schemaaux; query := 'SELECT create_reference_table(''' || schemaaux || '.DATASET_VALUE'')'; execute query; exception when others then RAISE NOTICE 'DATASET_VALUE Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.TABLE_VALUE'')'; execute query; exception when others then RAISE NOTICE 'TABLE_VALUE Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.RECORD_VALUE'')'; execute query; exception when others then RAISE NOTICE 'RECORD_VALUE Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.FIELD_VALUE'')'; execute query; exception when others then RAISE NOTICE 'FIELD_VALUE Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.VALIDATION'')'; execute query; exception when others then RAISE NOTICE '.VALIDATION Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.DATASET_VALIDATION'')'; execute query; exception when others then RAISE NOTICE 'DATASET_VALIDATION Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.TABLE_VALIDATION'')'; execute query; exception when others then RAISE NOTICE 'TABLE_VALIDATION Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.RECORD_VALIDATION'')'; execute query; exception when others then RAISE NOTICE 'RECORD_VALIDATION Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.FIELD_VALIDATION'')'; execute query; exception when others then RAISE NOTICE 'FIELD_VALIDATION Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.ATTACHMENT_VALUE'')'; execute query; exception when others then RAISE NOTICE 'ATTACHMENT_VALUE Err'; end; commit; begin schemaaux := replace(table_row::text ,'(' , ''); schemaaux := replace(schemaaux,')',''); query := 'SELECT create_reference_table('''||schemaaux||'.TEMP_ETLEXPORT'')'; execute query; exception when others then RAISE NOTICE 'TEMP_ETLEXPORT Err'; end; commit; exception when others then RAISE NOTICE 'Total error Err'; end; end loop; perform set_config('search_path', default_search_path, false); end; $$